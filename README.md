# Simulations for the PLOS One FPSP paper.
The models used in these simulations refer to the spread of the Covid19 and were both validated using the data from the Italian outbreak (see [GitHub](https://github.com/pcm-dpc/COVID-19)).

A description of the SIDARTHE can be found in this [Nature paper](https://www.nature.com/articles/s41591-020-0883-7).
A description of the SIQR can be found on [Research Gate]( https://www.researchgate.net/publication/339915690_Quantifying_undetected_COVID-19_cases_and_effects_of_containment_measures_in_Italy_Predicting_phase_2_dynamics).

## Demo

An interactive demo of the Fast Periodic Switching Policy with and witout slow outer supervisory control applied to an SIQR model is available online [here](http://samoa.dcs.gla.ac.uk/covid19dashboard/2020_10_06_group_siqr)

## Prerequisits

### MATLAB

Simulations were performed using Matlab 2017b, 2019a, 2019b and 2020a.
The libraries needed to simulate this code can be found [here](https://it.mathworks.com/matlabcentral/fileexchange/41372-hybrid-equations-toolbox-v2-04).
If you want to modify the code, a quick tutorial on the hybrid solver for switched systems can be found [here](https://www.mathworks.com/videos/hyeq-a-toolbox-for-simulation-of-hybrid-dynamical-systems-81992.html).

### Python

Figures 8-12 in Materials and Methods were generated using Python.

It is assumed that [Conda](https://docs.conda.io/en/latest/miniconda.html) is installed.
```
conda create -n fpsp python=3.7
conda activate fpsp
conda install jupyter nb_conda_kernels mkl numpy scipy theano
conda install -c conda-forge pymc3
```

The following packages are required to be installed within the new conda environment.

`pip install matplotlib pandas  `

In order to execute a python notebook, activate the conda environment, navigate to the root folder of the repository and start jupyter.

```
cd <repository root>
conda activate fpsp
jupyter notebook
```

## Structure

The folders are organised as follows: 

### `python/`

- `notebooks/01 Quarantine Effectiveness (Figure 8).ipynb` generates Figure 8.
- `notebooks/02 Compensatory Behavior (Figure 9).ipynb` generates Figure 9.
- `notebooks/03 Parameter Uncertainty (Figure 10).ipynb` generates Figure 10.
- `notebooks/99 SEIR_Gamma (response to reviewers).ipynb` simulates an SEIR model with Gamma-distributed incubation time and recovery time. Example simulations were included in the responses to reviewers.

### `matlab/`
- `SIDARTHE/SIDARTHE_Heatmap` contains the files needed to generate Figures 5 and 7. Execute the Main file;
- `SIDARTHE/SIDARTHE_policy_distribution` contains the files needed to generate Figure 2 (bottom). Execute the main file and then execute peakDistributionImage.m in 
`SIDARTHE/SIDARTHE_policy_distribution\ImageCreation`;
- `SIDARTHE/SIDARTHE_OuterLoop` contains the files needed to generate Figures 3. Execute the Main file;
- `SIQR/SIQR_1_14` contains the files to simulate the SIQR model for FPSP policies from X=1 working days and Y=1 quarantine days to X=14 working days and Y=14 quarantine days with increments of 1 day.
    - The main file to execute is `SIQR_1_14/Main.m`. 
    - Images are generated by `SIQR/SIQR_1_14/ImageGeneration_SIQR_1_14.m` and by `SIQR/SIQR_mixed/ImageGenerationMixed.m` (see below) after running the main file.
- `SIQR/SIQR_7_14` contains the files to simulate the SIQR model for FPSP policies from X=1 working days and Y=1 quarantine days to X=98 working days and Y=98 quarantine days with increments of 7 days.
    - The main file to execute is `SIQR/SIQR_7_14/Main.m`. 
    - Images are generated by `SIQR/SIQR_7_14/ImageGeneration_SIQR_7_14.m` and by `SIQR/SIQR_mixed/ImageGenerationMixed.m` (see below) after running the main file.
- `SIQR/SIQR_mixed` contains the file `ImageGenerationMixed.m` which is used to create joint images using data both of SIQR_1_14 and SIQR_7_14. It requires both `SIQR/SIQR_1_14/Main.m" and `SIQR_7_14/Main.m` to be run first.











